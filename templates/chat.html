<html>

    <head>
        <title>Chat</title>
    </head>
    <style type="text/css">
        input {
            display: block;
        }
        ul {
            list-style: none;
        }
    </style>
    
    <body>
        <ul id="messages"></ul>
        <form id="chatbox">
            {{.UserData.name}}:<br>
            <textarea cols="30" rows="10"></textarea>
            <input type="submit" value="Send">
        </form>
        <script>
            let socket = null;
            const msgBox = document.querySelector("#chatbox textarea");
            const messages = document.querySelector("#messages")
            const formChat = document.querySelector("#chatbox")
            let li;
            formChat.addEventListener("submit", (e) => {
                e.preventDefault();
                if (!msgBox.value) return false;
                
                if (!socket) {
                    alert("Error: There is no socket connection.");
                    return false;
                }
                socket.send(JSON.stringify({"Message": msgBox.value}))
                msgBox.value = "";
                return false;
            });
            
            if (!window["WebSocket"]) {
                alert("Error: Your browser does not support web sockets.")
            } else {
                socket = new WebSocket("wss://{{.Host}}/room")
                socket.addEventListener('open', function (event) {
                    console.log("ConexÃ£o aberta");
                });
                socket.onclose = () => alert("Connection has been closed.");
            }
            
            socket.onmessage = e => {
                var msg = eval("("+e.data+")");
                console.log(JSON.parse(e.data))
                li = document.createElement("li");
                var strong = document.createElement("strong");
                strong.textContent = `${msg.Name}: `;
                var span = document.createElement("span")
                span.textContent = msg.Message
                
                li.appendChild(strong);
                li.appendChild(span);
                messages.appendChild(li);
                
            }
            
        </script>
    </body>

</html>
